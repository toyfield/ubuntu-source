name: show ubuntu source

on:
  push:
    branches:
      - main
  workflow_dispatch:

concurrency:
  group: ubuntu-source
  cancel-in-progress: true

jobs:
  show-source:
    strategy:
      matrix:
        os: [ubuntu-latest, ubuntu-24.04-arm]
    runs-on: ${{ matrix.os }}
    steps:
      - name: Show Ubuntu Source Information
        run: |
          echo "=== Ubuntu System Information ==="
          lsb_release -a
          
          echo -e "\n=== OS Release Info ==="
          cat /etc/os-release
          
          echo -e "\n=== System Version ==="
          uname -a
          
          echo -e "\n=== Available Package Sources ==="
          cat /etc/apt/sources.list
          
          echo -e "\n=== Additional Sources ==="
          if [ -d /etc/apt/sources.list.d ]; then
            ls -la /etc/apt/sources.list.d/
            for file in /etc/apt/sources.list.d/*; do
              if [ -f "$file" ]; then
                echo "--- $file ---"
                cat "$file"
              fi
            done
          fi

          echo -e "\n---/etc/apt/apt-mirrors.txt----"
          cat /etc/apt/apt-mirrors.txt
          
          echo -e "\n=== Package Cache Info ==="
          apt list --installed | head -20
          
          echo -e "\n=== Available Updates ==="
          apt list --upgradable | head -10
      - name: upload
        uses: actions/upload-artifact@v4
        with:
          name: ${{ matrix.os }}-source
          path: |
            /etc/apt/apt-mirrors.txt
            /etc/apt/sources.list
            /etc/apt/sources.list.d/
          retention-days: 7